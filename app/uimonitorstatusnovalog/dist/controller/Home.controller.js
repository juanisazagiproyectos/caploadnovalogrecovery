sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/base/util/uid"],function(e){"use strict";return e.extend("com.esenttia.uimonitorstatusnovalog.controller.Home",{onInit:function(){this._oTable=this.byId("table0");this._createReadOnlyTemplates();this.rebindTable(this.oReadOnlyTemplate,"Navigation");this.oEditableTemplate=new sap.m.ColumnListItem({cells:[new sap.m.Input({value:"{mainModel>id}",change:[this.onInputChange,this]}),new sap.m.Input({value:"{mainModel>description}",change:[this.onInputChange,this]})]})},onOpenAddDialog:function(){this.getView().byId("OpenDialog").open()},onCancelDialog:function(e){e.getSource().getParent().close()},onCreate:function(){var e=this.getView().byId("id").getValue();var t=this.getView().byId("OpenDialog");if(e!==""){var a=this._oTable;var i=a.getBinding("items");var s=globalThis.crypto.randomUUID();var n=new Date;var o=n.toJSON();var l="juan.isaza@giproyectos.com";var r=new Date;const e=i.create({id:s,description:this.byId("descripcion").getValue(),createdBy:l,createdAt:o});try{e.created().then(function(){t.close();sap.m.MessageToast.show("Registro adicionado correctamente")},function(e){t.close();sap.m.MessageToast.show(e.toString())})}catch(e){sap.m.MessageBox.alert(e.toString())}}else{sap.m.MessageBox.alert("Debe ingresar un ID")}},onDelete:function(){var e=this.byId("table0").getSelectedItem();if(e){var t=e.getBindingContext("mainModel").getObject().id;e.getBindingContext("mainModel").delete("$auto").then(function(){sap.m.MessageToast.show(t+" borrado exitosamente")}.bind(this),function(e){sap.m.MessageToast.show("Error borrando: "+e)})}else{sap.m.MessageToast.show("Seleccione una fila para borrar")}},onEditMode:function(){this.byId("editModeButton").setVisible(false);this.byId("saveButton").setVisible(true);this.byId("deleteButton").setVisible(true);this.rebindTable(this.oEditableTemplate,"Edit")},rebindTable:function(e,t){this._oTable.bindItems({path:"mainModel>/Status",template:e,templateShareable:true}).setKeyboardMode(t)},onInputChange:function(){this.refreshModel("mainModel")},refreshModel:function(e,t){return new Promise((a,i)=>{this.makeChangesAndSubmit.call(this,a,i,e,t)})},makeChangesAndSubmit:function(e,t,a,i){const s=this;a="mainModel";i="$auto";if(s.getView().getModel(a).hasPendingChanges(i)){s.getView().getModel(a).submitBatch(i).then(n=>{s.makeChangesAndSubmit(e,t,a,i);sap.m.MessageToast.show("Registro actualizado correctamente")},t).catch(function e(t){sap.m.MessageToast.show("Error actualizando registro ",t.message)})}else{s.getView().getModel(a).refresh(i);e()}},onSave:function(){this.getView().byId("editModeButton").setVisible(true);this.getView().byId("saveButton").setVisible(false);this._oTable.setMode(sap.m.ListMode.None);this.rebindTable(this.oReadOnlyTemplate,"Navigation")},_createReadOnlyTemplates:function(){this.oReadOnlyTemplate=new sap.m.ColumnListItem({cells:[new sap.m.Text({text:"{mainModel>id}"}),new sap.m.Text({text:"{mainModel>description}"})]})}})});